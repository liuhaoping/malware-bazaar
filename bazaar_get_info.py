#!/usr/bin/env python3
import requests
import json
import argparse
from jq import jq

__author__ = "Haoping Liu"
__license__ = "Creative Commons Attribution-ShareAlike 4.0 International License."
__version__ = "1.0"
__email__ = "liuhauping@gmail.com"

#https://bazaar.abuse.ch/api/#query_hash

parser = argparse.ArgumentParser(description='Query sample information by hash value on Malware Bazaar by abuse.ch')
parser.add_argument('-s', '--sha', help='Hash value (e.g. sha256, MD5 or sha1)', type=str, metavar="HASH", required=True)
parser.add_argument('-f', '--field', help='Single field you want', type=str, metavar="FIELD", required=False, choices=['sha256_hash', 'sha1_hash', 'md5_hash', 'file_name', 'signature', 'imphash'])


args = parser.parse_args()

data = {
    'query': 'get_info',
    'hash': ''+args.sha+'',
}

response = requests.post('https://mb-api.abuse.ch/api/v1/', data=data, timeout=15)
json_response = response.content.decode("utf-8", "ignore")

if(args.field):
    query = ".data[]." + args.field
    json_response = jq(query).transform(text=json_response, text_output=True).strip('"')

print(json_response)
