#!/usr/bin/env python

from malwarebazaar.api import Bazaar
bazaar = Bazaar("myapikey")
#bazaar.query_hash("16a33ff1076ad51388af14a2f735a4de0a205a6a2a658598e11225368d686c10")



records = []
with open('malware_bazaar.jlzjd') as file:
    SDBFs = file.readlines()
      

lines = []
lines.append('sha256_hash,sha1_hash,tlsh,signature,jLZJD_hash')
for SDBF in SDBFs:
    sha256 = SDBF.split(':')[1][2:66]
    #print(sha256)
    jLZJD = SDBF.split(':')[2]
    #print(jLZJD )
    res = bazaar.query_hash(sha256)
    if res['data'][0]['sha1_hash'] and res['data'][0]['signature'] and res['data'][0]['tlsh'] is not None:
        line =   (sha256 + "," +
                    res['data'][0]['sha1_hash'] + "," +
                    res['data'][0]['tlsh'] + "," +\
                    res['data'][0]['signature'] + "," + 
                    jLZJD)
        lines.append(line)


with open('malware_bazaar.jlzjd.csv', 'w') as filehandle:
    for line in lines:
        filehandle.write('%s' % line)

