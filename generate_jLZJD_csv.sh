#!/bin/bash

# Goal : Download samples, generate jLZJD_hash and concate to csv file
#
# input : malware_bazaar.csv
# sha1_hash,tlsh,signature
# 003411d0a9610cfe8a027a364b46c489fa034502,AF74AD89B6257A65DE3A727411C78FC1B994D007602253AFE040F397BC17BEA3E7A1E4,Quakbot
#
# output: malware_bazaar.jLZJD.csv
###

# cut sha1 field
cd ~/malware-bazaar/
cut -d, -f 1 malware_bazaar.csv > malware_bazaar.sha1.tmp

# get sha256 values
while read -r line; do python bazaar_get_info.py -s $line -f sha256_hash; done < malware_bazaar.sha1.tmp  >> malware_bazaar.sha256.tmp

# downlaod file by given sha256
while read -r line; do python bazaar_download.py -s $line -u; done < malware_bazaar.sha256.tmp

# generate SBDFs from folder files
cd ~/malware-bazaar/download
java -cp ../../jLZJD/target/jLZJD-1.0-SNAPSHOT-jar-with-dependencies.jar com.edwardraff.jlzjd.Main -r  . -o ../malware_bazaar.jlzjd.tmp

# generate sha256,tlsh,jLZJD list into csv file
cd ~/malware-bazaar/
python generate_jLZJD_csv.py

rm *.tmp



























